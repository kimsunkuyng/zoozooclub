<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>공지사항 글 작성하기</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Travelix Project">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
<link href="plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.carousel.css">
<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.theme.default.css">
<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/animate.css">
<link rel="stylesheet" type="text/css" href="../../styles/cswrite.css">
<link rel="stylesheet" type="text/css" href="../../styles/cswrite_responsive.css">
<!-- Quill 에디터 CDN -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>


</head>

<body>
<div class="super_container" >
<form id="cswriteform"th:action="${mode=='update'}? @{/board/csmain}:@{/board/csinsert}" method="POST">
	<input type="hidden" name="csMode" value="updateCsPost" th:if="${mode == 'update'}"/>
	<input type="hidden" name="csNo" th:value="${board.csNo}"/>
	<div th:replace="views/common/header"></div>
	<div class="cs" style="margin-top:200px; color:black;">
		<div class="product-post-section">
		 
		 <input type="hidden" name="pNo" th:value="${p != null ? p.productNo : board.productNo}">
		 
		 <div class="productinfo" th:if="${p != null}" 
		     style="display: flex; align-items: center; gap: 10px;">
<!-- 		     <input type="hidden" name="pNo" th:value="${p.productNo}"> -->
		     <input type="hidden" name="pImg" th:value="${p.productImage}">
		    <img th:src="@{/images/{img}(img=${p.productImage})}" 
		         style="width: 80px; height: 80px; object-fit: cover;">
		    <span>상품명 : [[${p.productName}]]</span>
		</div>
		  
		  <div class="product-button-group">
<!-- 		    <button class="product-btn">상품불러오기</button> -->
		  </div>
		</div>
		<hr>
		<div class="title-row" style="display: flex; align-items: center; gap: 10px;margin-bottom:10px;">
  			<label for="csTitle" style="font-size:20px;margin-right:20px;margin-left:20px; margin-top:10px;color:gray;"><strong>제목</strong></label>
  				<select id="csTitle" name="csTitle" style="padding: 5px 10px; font-size: 18px;">
				    <option value="배송문의" th:selected="${board.csTitle=='배송문의'}">배송문의</option>
				    <option value="상품문의" th:selected="${board.csTitle=='상품문의'}">상품문의</option>
				    <option value="교환문의" th:selected="${board.csTitle=='교환문의'}">교환문의</option>
				    <option value="기타문의" th:selected="${board.csTitle=='기타문의'}">기타문의</option>
 				</select>
		</div>
		<div class="editor-box">
    		<div id="editor-container"></div><!-- 에디터 -->
    		<textarea class="editor-textarea" placeholder="본문 내용을 입력해주세요." name="csContent" th:text="${board.csContent}"> </textarea>
  		</div>
  
  		<div class="private-post" style="font-size:18px;">
	  		<label for="postsetting" style="margin-top:10px;">비밀글설정</label>
	  		<label style="margin-left:10px;color:gray;">
	  			<input type="radio" name="csSecret" id="private" value="Y" th:checked="${board.csSecret == null || board.csSecret=='Y'}" onchange="clickPublic()">비밀글
	  		</label>
	  		<label style="color:gray;">
	  			<input type="radio" name="csSecret"id="pubilc" value="N" th:checked="${board.csSecret=='N'}" onchange="clickPublic()">공개글
	  		</label>
	  	</div>
  
  		<div class="main-password-row" style="margin-top:10px;font-size:18px;">
    		<label for="mainPassword">비밀번호</label>
    		<input type="text" id="mainPassword" name="csPassword" th:value="${board.csPassword == null || board.csPassword ==0}?'':${board.csPassword}" maxlength="4"/>
  		</div>
	  	<div class="main-password-guide">
		    <p style="font-size: 15px; color: gray;">
		      (4자리 숫자 입력)
		    </p>
	  	</div>
		  <div class="password-buttons">
		    	<button class="list-btn" onclick="goTocslistPage()">목록</button>
		    <div class="right-buttons">
			    <button class="enroll-btn" onclick="csenroll()">등록</button>
			    <button class="cacel-btn"onclick="cscancel()">취소</button>
		    </div>
		  </div>
	</div>
<div th:replace="views/common/footer"></div>
</form>
</div>
<script th:inline="javascript">
	function goTocslistPage(){
		window.location.href="/board/cslist";
	}
	
	function csenroll(){
		
		const textOnly = quill.getText().trim(); // 태그 제거된 순수 텍스트
	    document.querySelector('.editor-textarea').value = textOnly;
	    document.getElementById('cswriteform').submit();
		
	}
	
	function cscancel(){
		const result=confirm("취소하시겠습니까?");
		if(result){
			alert("취소되었습니다.");
			location.reload();
		}
	}
	
	 function clickPublic() {
		    const isSecret = document.getElementById("private").checked;
		    const passwordInput = document.getElementById("mainPassword");
		    passwordInput.disabled = !isSecret;

		    if (!isSecret) {
		      passwordInput.value = '';
		    }
		  }

		  window.addEventListener("DOMContentLoaded", clickPublic);
		  
		  let quill;

		  window.addEventListener('DOMContentLoaded', () => {
		    quill = new Quill('#editor-container', {
		      theme: 'snow'
		    });

		    
		    const content = document.querySelector('.editor-textarea').textContent;
		    if(content) {
		      quill.root.innerHTML = content;
		    }

		    
		    const form = document.getElementById('cswriteform');
		    form.addEventListener('submit', function () {
		    	  document.querySelector('.editor-textarea').value = quill.getText().trim();
		    });
		  });
</script>

</body>

</html>