<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<title>ğŸ¶ZOOZOOCLUB_SHOPPING</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="Travelix Project">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="../styles/bootstrap4/bootstrap.min.css">
	<link href="../plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="../styles/offers_styles.css">
	<link rel="stylesheet" type="text/css" href="../styles/offers_responsive.css">
	<link rel="stylesheet" href="/styles/mypage.css">
</head>
	<style>
	
	.top_bar,
	.topBlock {
	  background-color: #F0BA7D; /* same as tab background */
	}
	
	.top_bar {
	  position: fixed;
	  top: 100px;
	  left: 0;
	  right: 0;
	  z-index: 100;
	  background-color: #F0BA7D;
	}
	
	.topBlock {
	  height: 2.5rem;
	  display: flex;
	  justify-content: center;
	  align-items: center;
	  margin: 0;  /* or small margin-bottom */
	}
 	
    .tab {
      width: 7rem;
      height: 2rem;
	  flex: none;
      padding: 1px 15px;
      background: #F0BA7D;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: rgb(78, 3, 3);
      font-weight: 500;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      border-radius: 30px;
    }

    .tab:hover {
      background-color: rgba(245, 234, 172, 0.5); /*ì»¤ì„œì„ íƒíš¨ê³¼*/
    }

    .tab.active {
      border-bottom: 3px solid #a74c02; /*ìŒì˜ì»¬ëŸ¬*/
      font-weight: bold;
      color: #a74c02; /*í°ë“œì»¬ëŸ¬*/
    }
    .tab:focus {
	  outline: none;
	}
	
	.carousel-wrapper {
	  width: 400px; /* or 100% if responsive */
	  overflow: hidden;
	  margin: auto;
	}
	
	.carousel-inner {
	  display: flex;
	  transition: transform 0.3s ease-in-out;
	  width: calc(100% * var(--total-cards));
	}
	
	.pet-card {
	  flex: 0 0 100%; /* show one card at a time */
	  display: flex;
	  align-items: center;
	  gap: 2rem;
	  padding: 1rem;
	  border: 1px solid black;
	  border-radius: 9999px;
	}
	
	.pet-card img {
	  width: 6rem;
	  height: 6rem;
	  object-fit: cover;
	  border-radius: 1rem;
	}
	
	.pet-info {
	  text-align: left;
	}
	
	.pet-info p {
	  margin: 0;
	}

	
	</style>


<body>
	<div th:replace="views/common/header"></div>
		<div class="top_bar">
		  <div class="topBlock">
		    <button class="tab active" onclick="loadPage('/member/profile',event)">í”„ë¡œí•„</button>
		    <button class="tab" onclick="loadPage('/member/couponPoint',event)">ì¿ í°í¬ì¸íŠ¸</button>
		    <button class="tab" onclick="loadPage('/member/orderhistory',event)">ì‡¼í•‘ë‚´ì—­</button>
		    <button class="tab" onclick="loadPage('/member/viewer',event)">íŒ»ê°¤ëŸ¬ë¦¬</button>
		    <button class="tab" onclick="loadPage('/member/myactivity',event)">ë‚˜ì˜í™œë™</button>
		    <button class="tab" onclick="loadPage('/member/setting',event)">ì„¤ì •</button>
		  </div>
		</div>
	<div class="alarm-bar" hidden>
    ğŸ“¸ Donâ€™t forget to add todayâ€™s memory!
  	</div>
  	<div id="page-container"></div>
  	
  	<div th:replace="views/common/footer"></div>
  	
	
	<script th:inline="javascript">
	
	
	window.onload = function (){
		loadPage("/member/profile");
		
	
	};
	
	function loadPage(url, event) {
	if(event){
	  event.preventDefault(); // ë¯¸ë¦¬ ìˆë˜ ë””í´íŠ¸ ì´ë²¤íŠ¸ë“¤ì„ ì œê±°í•´ì¤€ë‹¤.
	  
	  // Remove active class from all tabs
	  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
	  event.target.classList.add('active');
	}

	  
	  fetch(url)
	  .then(res => res.text())
	  .then(html => {
	    document.getElementById("page-container").innerHTML = html;

	    const script = document.querySelector("#page-container #dynamic-script");
	    if (script) {
	      eval(script.textContent); // ğŸ‘ˆ this triggers dynamic interaction
	    }
	    
	     currentIndex = 0;
	     setTimeout(() => {
	       updateCarousel();
	     }, 10);
	  });
	}
	// ==================== review ========================ã…—
	function loadReview(url, event) {
	  event.preventDefault();
	
	  const button = event.target;
	  const wrapper = button.closest('.order-info').querySelector('.review-wrapper');
	  const container = wrapper.querySelector('.review-container');
	
	  if (container.innerHTML.trim() === '') {
	    fetch(url)
	      .then(res => res.text())
	      .then(html => {
	        container.innerHTML = html;
	        wrapper.style.display = 'block';
	      });
	  } else {
	    wrapper.style.display = 'block';
	  }
	}
	
	function cancelReview() {
	  const wrapper = event.target.closest('.review-wrapper');
	  const container = wrapper.querySelector('.review-container');
	  container.innerHTML = '';
	  wrapper.style.display = 'none';
	}
	
	
	
	let isIdValid = false;
	const originalId = /*[[${session.loginUser.memberId}]]*/ "defaultId"; // Thymeleaf will replace this
	console.log("originalId = ", originalId);

	// ì¤‘ë³µì²´í¬ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ í˜¸ì¶œë¨
	function checkId() {
	  const memberId = document.getElementById("memberId").value.trim();
	  const resultTag = document.getElementById("idCheckResult");

	  if (memberId === originalId || (memberId === "" && originalId === "")) {
	    resultTag.innerText = "í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
	    isIdValid = true;
	    return;
	  }

	  if (memberId === "" && originalId !== "") {
	    resultTag.innerText = "ì•„ì´ë””ëŠ” ë¹„ì›Œë‘˜ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
	    isIdValid = false;
	    return;
	  }

	  // ì¤‘ë³µì²´í¬ ìš”ì²­
	  fetch(`/member/checkId?memberId=${encodeURIComponent(memberId)}`)
	    .then(response => response.text())
	    .then(data => {
	      if (data === "OK") {
	        resultTag.innerText = "ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
	        isIdValid = true;
	      } else {
	        resultTag.innerText = "ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
	        document.getElementById("memberId").value ="";
	        isIdValid = false;
	      }
	    })
	    .catch(err => {
	      console.error("ID check error:", err);
	      resultTag.innerText = "ì„œë²„ ì˜¤ë¥˜ë¡œ ì¤‘ë³µ í™•ì¸ ì‹¤íŒ¨";
	      isIdValid = false;
	    });
	}

	// ìµœì¢… ì œì¶œ ì „ì— ìœ íš¨ì„± ê²€ì‚¬
	function finalValidation() {
	  const memberId = document.getElementById("memberId").value.trim();

	  if (memberId === "" && originalId !== "") {
	    alert("ì•„ì´ë””ë¥¼ ë¹„ìš¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	    return false;
	  }

// 	  if (!isIdValid) {
// 	    alert("ì•„ì´ë”” ì¤‘ë³µì²´í¬ë¥¼ í•´ì£¼ì„¸ìš”.");
// 	    return false;
// 	  }

	  return true;
	}
	
	function showVerify(){
		const phone = document.getElementById("phone").value;
		
		fetch("/send", {
			method: "post",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify({phone})
		})
		
		const box = document.getElementById("verifyBox");
		box.hidden = false;
		
		document.getElementById("verifyInput").focus();
	}
	
	function verifyInputBtn(){
		
		const verifyNum = document.getElementById("verifyInput").value;
		
		fetch("/verify", {
			method: "post",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify({verifyNum})
		})
		
		.then(response => response.text())
		.then(data=> {
			if(data =="Ok"){
				clearInterval(interval);
				document.getElementById('verifyBtn').innerText ="ì¸ì¦ ì™„ë£Œ";
				fetch("/verifyUpdate", {
				    method: "POST"
				  }).then(res => res.text())
				    .then(msg => console.log("Server session updated:", msg));
				document.getElementById("verifyBox").hidden = true;
			} else {
				document.getElementById("smsSuccess").innerText ="ì¸ì¦ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.";
			}
		
		})

	}
	
	let interval;
	
	function handleVerifyClick() {
		  const button = document.getElementById('verifyBtn');
		  		  
		  showVerify();

		  // Start countdown
		  let seconds = 60;
		  interval = setInterval(() => {
		    seconds--;
		    button.innerText = `${seconds}ì´ˆí›„ í™œì„±í™” `;

		    if (seconds <= 0) {
		      clearInterval(interval);
		      button.disabled = false;
		      button.innerText = "ì¸ì¦ë²ˆí˜¸ ë°›ê¸°";
		    }
		  }, 1000);
		  
		 // Disable the button
		  button.disabled = true;
		 
		}
	  function setupPetFormInteractions() {


		    const breedOptions = {
		      dog: ['ë§í‹°ì¦ˆ', 'í‘¸ë“¤', 'ì§„ë—ê°œ', 'í¬ë©”ë¼ë‹ˆì•ˆ', 'ì‹œì¸„', 'ë¹„ìˆ‘ í”„ë¦¬ì œ', 'ìš”í¬ì…” í…Œë¦¬ì–´', 'ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„', 'ë¼ë¸Œë¼ë„ ë¦¬íŠ¸ë¦¬ë²„', 'í”„ë Œì¹˜ ë¶ˆë„ê·¸'],
		      cat: ['ì½”ë¦¬ì•ˆ ìˆí—¤ì–´', 'ëŸ¬ì‹œì•ˆ ë¸”ë£¨', 'ìƒ´', 'ìŠ¤ì½”í‹°ì‹œ í´ë“œ', 'ë¸Œë¦¬í‹°ì‹œ ì‡¼íŠ¸í—¤ì–´', 'í˜ë¥´ì‹œì•ˆ', 'ë™ëŒ', 'ë©”ì¸ì¿¤', 'ë²µê°ˆ', 'ë…¸ë¥´ì›¨ì´ ìˆ² ê³ ì–‘ì´'],
		      etc: ['í–„ìŠ¤í„°', 'ê¸°ë‹ˆí”¼ê·¸', 'í† ë¼', 'í˜ëŸ¿', 'ìŠˆê°€ ê¸€ë¼ì´ë”','ì•µë¬´ìƒˆ', 'ì‰ê¼¬', 'ì¹´ë‚˜ë¦¬ì•„', 'ëŸ¬ë¸Œë²„ë“œ', 'ì™•ê´€ì•µë¬´','ê±°ë¶ì´', 'ë ˆì˜¤íŒŒë“œ ê²Œì½”', 'ë³¼ íŒŒì´í†¤', 'ì²­ê°œêµ¬ë¦¬', 'ë„ë¡±ë‡½','ì‚¬ìŠ´ë²Œë ˆ', 'ì¥ìˆ˜í’ë…ì´', 'íƒ€ë€íŠ¤ë¼', 'ì§€ë„¤', 'ì „ê°ˆ']
		    };

		    const buttons = document.querySelectorAll('.pet-type button');
		    const select = document.getElementById('breedSelect');



		    buttons.forEach(btn => {
		      btn.addEventListener('click', () => {
		        const type = btn.dataset.type;
	
		        select.innerHTML = '<option value="" disabled selected>í’ˆì¢…ì„ ì„ íƒí•˜ì„¸ìš”</option>';
		        breedOptions[type].forEach(breed => {
		          const opt = document.createElement('option');
		          opt.value = breed;
		          opt.textContent = breed;
		          select.appendChild(opt);
		        });
		      });
		    });
		    
		    
		  }
	  
	  let currentIndex = 0;

	  function updateCarousel() {
	    const carousel = document.getElementById("petCarousel");
	    const cards = carousel.children;
	    const total = cards.length;

	    if (currentIndex < 0) currentIndex = 0;
	    if (currentIndex >= total) currentIndex = total - 1;

	    // Set total width
	    carousel.style.width = `${100 * total}%`;

	    // Slide effect
	    const offset = -currentIndex * (100 / total);
	    carousel.style.transform = `translateX(${offset}%)`;

	    // Set card width
	    for (let card of cards) {
	      card.style.flex = `0 0 ${100 / total}%`;
	    }
	  }

	  function nextSlide() {
	    currentIndex++;
	    updateCarousel();
	  }

	  function prevSlide() {
	    currentIndex--;
	    updateCarousel();
	  }

	  // Run on first load (after dynamic content is loaded)
	  window.addEventListener("load", updateCarousel);
	</script>
	
</body>

</html>